#!/usr/bin/env sh

# Prevent commits directly to main/develop branches (skip on first commit when no HEAD)
if git rev-parse --verify --quiet HEAD >/dev/null 2>&1; then
  BRANCH=$(git rev-parse --abbrev-ref HEAD)
  if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "develop" ]; then
    echo "âŒ ERROR: Cannot commit directly to '$BRANCH' branch"
    echo ""
    echo "Proper workflow:"
    echo "  1. Create a feature branch:  git checkout -b feature/your-feature"
    echo "  2. Make changes and commit:  git commit -m 'feat: your message'"
    echo "  3. Merge to main locally:    git checkout main && git merge feature/your-feature"
    echo "  4. Push from main:           git push origin main"
    echo ""
    echo "To force (not recommended):   git commit --no-verify"
    exit 1
  fi
fi

pnpm exec prettier --write . --ignore-unknown
pnpm exec eslint . --fix

# Re-stage files that were modified by formatting/linting
# Initial commit has no HEAD, so use git add . in that case
if git rev-parse --verify --quiet HEAD >/dev/null 2>&1; then
  git add -u
else
  git add .
fi

# Optional hardening (disabled by default)
# pnpm exec eslint . --max-warnings=0
# pnpm exec prettier --check . --ignore-unknown


